<div class="graphic-container">
  <!-- Bouton pour ouvrir/fermer le panneau principal -->
  <button mat-mini-fab class="open-graphic-button" (click)="togglePanel()" matTooltip="Graphique"
    matTooltipPosition="below" aria-label="Ouvrir le panneau des graphiques">
    <mat-icon>pie_chart</mat-icon>
  </button>

  <div *ngIf="isPanelOpen" class="graphic-panel mat-elevation-z8" cdkDrag>
    <div class="graphic-header" cdkDragHandle>
      <button *ngIf="currentView === 'chart'" mat-icon-button (click)="showGrid()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <span class="active-chart-title">{{ activeChartTitle }}</span>
      <button mat-icon-button (click)="togglePanel()" aria-label="Fermer le panneau" matTooltip="Fermer">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="graphic-content">
      <!-- Colonne de Gauche -->
      <div class="chart-display-area">
        <!-- Grille de Sélection -->
        <div *ngIf="currentView === 'library'" class="admin-chart-grid">
          <!-- Vos 6 boîtes cliquables ici -->
          <div class="chart-preview-box" (click)="loadPreset('chart1_id')">
            <div class="chart-preview-image"><img src="https://i.imgur.com/8X5J4Jq.png" alt="Aperçu Bump Chart"></div>
            <div class="chart-preview-title">
              <h4>chart 1</h4>
            </div>
          </div>
          <div class="chart-preview-box" (click)="loadPreset('chart2_id')">
            <div class="chart-preview-image"><img src="https://i.imgur.com/2s3F4qL.png"
                alt="Aperçu Variation de Température"></div>
            <div class="chart-preview-title">
              <h4>chart 1</h4>
            </div>
          </div>
          <div class="chart-preview-box" (click)="loadPreset('chart3_id')">
            <div class="chart-preview-image"><img src="https://i.imgur.com/KzD5g6t.png" alt="Aperçu Graphique en Aires">
            </div>
            <div class="chart-preview-title">
              <h4>chart 1</h4>
            </div>
          </div>
          <div class="chart-preview-box" (click)="loadPreset('chart4_id')">
            <div class="chart-preview-image"><img src="https://i.imgur.com/V2z6v6d.png"
                alt="Aperçu Données à Grande Échelle"></div>
            <div class="chart-preview-title">
              <h4>chart 1</h4>
            </div>
          </div>
          <div class="chart-preview-box" (click)="loadPreset('chart5_id')">
            <div class="chart-preview-image"><img src="https://i.imgur.com/UfG5t4r.png" alt="Aperçu Bande de Confiance">
            </div>
            <div class="chart-preview-title">
              <h4>chart 1</h4>
            </div>
          </div>
          <div class="chart-preview-box" (click)="loadPreset('chart6_id')">
            <div class="chart-preview-image"><img src="https://i.imgur.com/M6x8d7n.png" alt="Aperçu Précipitations">
            </div>
            <div class="chart-preview-title">
              <h4>chart 1</h4>
            </div>
          </div>
        </div>

        <!--  MODIFICATION : Ajout de #chartHost pour pouvoir mesurer la taille du conteneur -->
        <div *ngIf="currentView === 'chart'" class="active-chart-container" #chartHost>
          <div echarts [options]="chartOptions" [initOpts]="{renderer: 'svg'}" class="chart-instance"
            (chartInit)="onChartInit($event)">
          </div>
        </div>
      </div>

      <!-- Colonne de Droite -->
      <div class="preset-selection-area">
        <div class="preset-list">
          <div class="preset-title">
            Graphiques Prédéfinis
          </div>
          <ul>
            <!-- <li class="clickable-list-item" (click)="loadSunburst()">
               Sunburst - Milieux Humides
            </li> -->
            <li *ngFor="let preset of adminPresets" class="clickable-list-item" (click)="loadPreset(preset.id)">
              {{ preset.name }}
            </li>
            <li *ngIf="adminPresets.length === 0" class="empty-list-message">
              Aucun preset administrateur.
            </li>
          </ul>
        </div>
        <div class="preset-list">
          <div class="preset-title">
            Mes Graphiques
          </div>
          <ul>
            <li *ngFor="let preset of userPresets" class="clickable-list-item" (click)="loadPreset(preset.id)">
              {{ preset.name }}
            </li>
            <li *ngIf="userPresets.length === 0" class="empty-list-message">
              Vous n'avez aucun graphique.
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="graphic-footer">
      <button mat-icon-button matTooltip="Personnaliser" (click)="customizeChart()">
        <mat-icon>settings</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Filtrer à la sélection" (click)="filterToSelection()">
        <mat-icon>filter_alt</mat-icon>
      </button>
      <!-- <button mat-icon-button matTooltip="Initialiser" (click)="resetChart()">
        <mat-icon>restart_alt</mat-icon>
      </button> -->
      <button mat-icon-button matTooltip="Exporter" (click)="exportChart()">
        <mat-icon>save_alt</mat-icon>
      </button>
      <!-- <button mat-icon-button matTooltip="Plein écran" (click)="toggleFullscreen()">
        <mat-icon>fullscreen</mat-icon>
      </button> -->
    </div>
  </div>
</div>